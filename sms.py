import base64
exec(base64.b64decode('aW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aW1lCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBzaHV0aWwKaW1wb3J0IGluc3BlY3QKaW1wb3J0IHN5cwpmcm9tIGNvbG9yYW1hIGltcG9ydCBGb3JlLCBTdHlsZSwgaW5pdAoKaW5pdChhdXRvcmVzZXQ9VHJ1ZSkKCnNtc19iYW5uZXJfbGluZXMgPSBbCiAgICAiICAgX19fX19fICAgICAgX19fXyAgICBfX19fICAgICBfX19fX18gICAgIiwKICAgICIgLicgX19fXyBcXCAgICB8XyAgIFxcICAvICAgX3wgIC4nIF9fX18gXFwgICAiLAogICAgIiB8IChfX18gXFxffCAgICAgfCAgIFxcLyAgIHwgICAgfCAoX19fIFxcX3wgICIsCiAgICAiICBfLl9fX19gLiAgICAgIHwgfFxcICAvfCB8ICAgICBfLl9fX19gLiAgICIsCiAgICAiIHwgXFxfX19fKSB8IF8gIF98IHxfXFwvX3wgfF8gIF98IFxcX19fXykgfCAgIiwKICAgICIgIFxcX19fX19fLicoXyl8X19fX198fF9fX19ffChfKVxcX19fX19fLicgICIKXQoKZGVmIGNsZWFyX3NjcmVlbigpOgogICAgc3VicHJvY2Vzcy5jYWxsKCJjbHMiIGlmIHN1YnByb2Nlc3Mub3MubmFtZSA9PSAibnQiIGVsc2UgImNsZWFyIiwgc2hlbGw9VHJ1ZSkKCmRlZiBhbmltYXRlX2Jhbm5lcigpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIHRlcm1fd2lkdGggPSBzaHV0aWwuZ2V0X3Rlcm1pbmFsX3NpemUoZmFsbGJhY2s9KDgwLCAyMCkpLmNvbHVtbnMKICAgIGZvciBfIGluIHJhbmdlKDUpOgogICAgICAgIHByaW50KCkKICAgIGZvciBsaW5lIGluIHNtc19iYW5uZXJfbGluZXM6CiAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgU3R5bGUuQlJJR0hUICsgbGluZS5jZW50ZXIodGVybV93aWR0aCkpCiAgICAgICAgdGltZS5zbGVlcCgwLjE1KQogICAgcHJpbnQoIlxuIikKCiMgPT09PT09PT09PT09PT09PT09PT09IEFQSSBGVU5DVElPTlMgPT09PT09PT09PT09PT09PT09PT09CgpkZWYgY2FsbF9jbGFzc3Jvb21iZF9hcGkocGhvbmVfbnVtYmVyKToKICAgIGltcG9ydCByZXF1ZXN0cwogICAgaW1wb3J0IHJlCgogICAgc2Vzc2lvbiA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgdHJ5OgogICAgICAgICMgU3RlcCAxOiBHZXQgdGhlIHJlZ2lzdHJhdGlvbiBwYWdlIHRvIHJldHJpZXZlIENTUkYgdG9rZW4KICAgICAgICByZXMgPSBzZXNzaW9uLmdldCgiaHR0cHM6Ly9jbGFzc3Jvb21iYW5nbGFkZXNoLmNvbS9yZWdpc3RlciIpCiAgICAgICAgY3NyZl90b2tlbl9tYXRjaCA9IHJlLnNlYXJjaChyJzxtZXRhIG5hbWU9ImNzcmYtdG9rZW4iIGNvbnRlbnQ9IiguKz8pIicsIHJlcy50ZXh0KQogICAgICAgIGlmIG5vdCBjc3JmX3Rva2VuX21hdGNoOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBjc3JmX3Rva2VuID0gY3NyZl90b2tlbl9tYXRjaC5ncm91cCgxKQoKICAgICAgICAjIFN0ZXAgMjogUHJlcGFyZSBoZWFkZXJzIGFuZCBzZW5kIE9UUCByZXF1ZXN0CiAgICAgICAgaGVhZGVycyA9IHsKICAgICAgICAgICAgImFjY2VwdCI6ICIqLyoiLAogICAgICAgICAgICAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCIsCiAgICAgICAgICAgICJvcmlnaW4iOiAiaHR0cHM6Ly9jbGFzc3Jvb21iYW5nbGFkZXNoLmNvbSIsCiAgICAgICAgICAgICJyZWZlcmVyIjogImh0dHBzOi8vY2xhc3Nyb29tYmFuZ2xhZGVzaC5jb20vcmVnaXN0ZXIiLAogICAgICAgICAgICAidXNlci1hZ2VudCI6ICJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMzcuMC4wLjAgTW9iaWxlIFNhZmFyaS81MzcuMzYiLAogICAgICAgICAgICAieC1jc3JmLXRva2VuIjogY3NyZl90b2tlbiwKICAgICAgICAgICAgIngtcmVxdWVzdGVkLXdpdGgiOiAiWE1MSHR0cFJlcXVlc3QiCiAgICAgICAgfQogICAgICAgIGRhdGEgPSBmInBob25lPXtwaG9uZV9udW1iZXJ9IgoKICAgICAgICByZXNwb25zZSA9IHNlc3Npb24ucG9zdCgiaHR0cHM6Ly9jbGFzc3Jvb21iYW5nbGFkZXNoLmNvbS9zZW5kLW90cCIsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhKQogICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDAKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgY2FsbF9ib2h1YnJpaGlfYXBpKHBob25lX251bWJlcik6CiAgICB1cmwgPSAiaHR0cHM6Ly9iYi1hcGkuYm9odWJyaWhpLmNvbS9wdWJsaWMvYWN0aXZpdHkvb3RwIgogICAgaGVhZGVycyA9IHsKICAgICAgICAiYWNjZXB0IjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKiIsCiAgICAgICAgImF1dGhvcml6YXRpb24iOiAiQmVhcmVyIHVuZGVmaW5lZCIsCiAgICAgICAgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAib3JpZ2luIjogImh0dHBzOi8vYm9odWJyaWhpLmNvbSIsCiAgICAgICAgInJlZmVyZXIiOiAiaHR0cHM6Ly9ib2h1YnJpaGkuY29tLyIsCiAgICAgICAgInVzZXItYWdlbnQiOiAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBLKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTM3LjAuMC4wIE1vYmlsZSBTYWZhcmkvNTM3LjM2IgogICAgfQogICAgZGF0YSA9IHsKICAgICAgICAicGhvbmUiOiAiMCIgKyBwaG9uZV9udW1iZXJbLTEwOl0sICAjIEVuc3VyZSBudW1iZXIgZm9ybWF0IGxpa2UgMDEzeHh4eHh4eAogICAgICAgICJpbnRlbnQiOiAibG9naW4iCiAgICB9CgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhKQogICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDAKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgY2FsbF9wYXRoYW9fYXBpKHBob25lX251bWJlcik6CiAgICB1cmwgPSAiaHR0cHM6Ly93ZWJhdXRoLnBhdGhhby5jb20vYXV0aC9nZXQtb3RwIgogICAgaGVhZGVycyA9IHsKICAgICAgICAiYWNjZXB0IjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKiIsCiAgICAgICAgImFjY2VwdC1sYW5ndWFnZSI6ICJlbi1VUyxlbjtxPTAuOSxibi1CRDtxPTAuOCxibjtxPTAuNyIsCiAgICAgICAgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAib3JpZ2luIjogImh0dHBzOi8vZm9vZC5wYXRoYW8uY29tIiwKICAgICAgICAicmVmZXJlciI6ICJodHRwczovL2Zvb2QucGF0aGFvLmNvbS8iLAogICAgICAgICJ1c2VyLWFnZW50IjogIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgSykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzNy4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNiIKICAgIH0KCiAgICBkYXRhID0gewogICAgICAgICJjb3VudHJ5X3ByZWZpeCI6ICI4ODAiLAogICAgICAgICJuYXRpb25hbF9udW1iZXIiOiBwaG9uZV9udW1iZXIubHN0cmlwKCIrODgwIiksCiAgICAgICAgImNvdW50cnlfaWQiOiAxLAogICAgICAgICJjbGllbnRfaWQiOiAiMjY4NzA5NTIzMSIKICAgIH0KCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwganNvbj1kYXRhLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIGNhbGxfYWNzX2FwaShwaG9uZV9udW1iZXIpOgogICAgdXJsID0gImh0dHBzOi8vYXV0aC5hY3NmdXR1cmVzY2hvb2wuY29tL2FwaS92MS9vdHAvc2VuZCIKCiAgICBoZWFkZXJzID0gewogICAgICAgICJhdXRob3JpdHkiOiAiYXV0aC5hY3NmdXR1cmVzY2hvb2wuY29tIiwKICAgICAgICAiYWNjZXB0IjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKiIsCiAgICAgICAgImFjY2VwdC1sYW5ndWFnZSI6ICJlbi1VUyxlbjtxPTAuOSIsCiAgICAgICAgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAib3JpZ2luIjogImh0dHBzOi8vd3d3LmFjc2Z1dHVyZXNjaG9vbC5jb20iLAogICAgICAgICJyZWZlcmVyIjogImh0dHBzOi8vd3d3LmFjc2Z1dHVyZXNjaG9vbC5jb20vIiwKICAgICAgICAic2VjLWNoLXVhIjogJyJDaHJvbWl1bSI7dj0iMTM3IiwgIk5vdC9BKUJyYW5kIjt2PSIyNCInLAogICAgICAgICJzZWMtY2gtdWEtbW9iaWxlIjogIj8xIiwKICAgICAgICAic2VjLWNoLXVhLXBsYXRmb3JtIjogJyJBbmRyb2lkIicsCiAgICAgICAgInNlYy1mZXRjaC1kZXN0IjogImVtcHR5IiwKICAgICAgICAic2VjLWZldGNoLW1vZGUiOiAiY29ycyIsCiAgICAgICAgInNlYy1mZXRjaC1zaXRlIjogInNhbWUtc2l0ZSIsCiAgICAgICAgInVzZXItYWdlbnQiOiAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBLKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTM3LjAuMC4wIE1vYmlsZSBTYWZhcmkvNTM3LjM2IgogICAgfQoKICAgIHBheWxvYWQgPSB7CiAgICAgICAgInBob25lIjogcGhvbmVfbnVtYmVyCiAgICB9CgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywganNvbj1wYXlsb2FkKQogICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDAKICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb246CiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgY2FsbF9iaWtyb3lfYXBpKHBob25lX251bWJlcik6CiAgICB1cmwgPSBmImh0dHBzOi8vYmlrcm95LmNvbS9kYXRhL3Bob25lX251bWJlcl9sb2dpbi92ZXJpZmljYXRpb25zL3Bob25lX2xvZ2luP3Bob25lPXtwaG9uZV9udW1iZXIubHN0cmlwKCcrODgnKX0iCiAgICBoZWFkZXJzID0gewogICAgICAgICJhY2NlcHQiOiAiYXBwbGljYXRpb24vanNvbiwgdGV4dC9wbGFpbiwgKi8qIiwKICAgICAgICAiYWNjZXB0LWxhbmd1YWdlIjogImJuIiwKICAgICAgICAiYXBwbGljYXRpb24tbmFtZSI6ICJ3ZWIiLAogICAgICAgICJyZWZlcmVyIjogImh0dHBzOi8vYmlrcm95LmNvbS9ibi91c2Vycy9sb2dpbj9hY3Rpb249bXktYWNjb3VudCZyZWRpcmVjdC11cmw9JTJGYm4lMkZteSUyRmRhc2hib2FyZCIsCiAgICAgICAgInVzZXItYWdlbnQiOiAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBLKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTM3LjAuMC4wIE1vYmlsZSBTYWZhcmkvNTM3LjM2IgogICAgfQoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIGhlYWRlcnM9aGVhZGVycykKICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwCiAgICBleGNlcHQ6CiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgY2FsbF9jYWxsX2FwaShtb2JpbGVfbnVtYmVyKToKICAgIHVybCA9IGYiaHR0cHM6Ly9jYWxsLWFwaS12aHR4Lm9ucmVuZGVyLmNvbS9zbXMvYXBpL3YxP251bT17bW9iaWxlX251bWJlcn0iCiAgICB0cnk6CiAgICAgICAgcmV0dXJuIHJlcXVlc3RzLmdldCh1cmwpLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIGNhbGxfaG9pY2hvaV9hcGkobW9iaWxlX251bWJlcik6CiAgICBwaG9uZSA9ICIrODgiICsgbW9iaWxlX251bWJlcgogICAgdXJsID0gImh0dHBzOi8vcHJvZC1hcGkudmlld2xpZnQuY29tL2lkZW50aXR5L3NpZ251cD9zaXRlPWhvaWNob2l0diZkZXZpY2VJZD1icm93c2VyLTBmOWQwOTU2LTFmNDktMjQ4Zi1mMTZlLTFlYTdkOTliMWRhOCIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgImFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICJvcmlnaW4iOiAiaHR0cHM6Ly93d3cuaG9pY2hvaS50diIsCiAgICAgICAgInJlZmVyZXIiOiAiaHR0cHM6Ly93d3cuaG9pY2hvaS50di8iLAogICAgICAgICJ1c2VyLWFnZW50IjogIk1vemlsbGEvNS4wIiwKICAgICAgICAieC1hcGkta2V5IjogIlBCU29vVWU5MXM3Uk5SS25YVG1RRzd6M2d3RDJhRFRBNlRsSnA2ZWYiCiAgICB9CiAgICBwYXlsb2FkID0gewogICAgICAgICJwaG9uZU51bWJlciI6IHBob25lLAogICAgICAgICJyZXF1ZXN0VHlwZSI6ICJzZW5kIiwKICAgICAgICAid2hhdHNhcHBDb25zZW50IjogVHJ1ZQogICAgfQogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywganNvbj1wYXlsb2FkKQogICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDAKICAgIGV4Y2VwdDoKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBjYWxsX2FwZXhfYXBpKHBob25lX251bWJlcik6CiAgICB1cmwgPSAnaHR0cHM6Ly9hcGkuYXBleDR1LmNvbS9hcGkvYXV0aC9sb2dpbicKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgJ2F1dGhvcml0eSc6ICdhcGkuYXBleDR1LmNvbScsCiAgICAgICAgJ2FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L3BsYWluLCAqLyonLAogICAgICAgICdhY2NlcHQtbGFuZ3VhZ2UnOiAnZW4tVVMsZW47cT0wLjknLAogICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgJ29yaWdpbic6ICdodHRwczovL2FwZXg0dS5jb20nLAogICAgICAgICdyZWZlcmVyJzogJ2h0dHBzOi8vYXBleDR1LmNvbS8nLAogICAgICAgICdzZWMtY2gtdWEnOiAnIkNocm9taXVtIjt2PSIxMzciLCAiTm90L0EpQnJhbmQiO3Y9IjI0IicsCiAgICAgICAgJ3NlYy1jaC11YS1tb2JpbGUnOiAnPzEnLAogICAgICAgICdzZWMtY2gtdWEtcGxhdGZvcm0nOiAnIkFuZHJvaWQiJywKICAgICAgICAndXNlci1hZ2VudCc6ICdNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMzcuMC4wLjAgTW9iaWxlIFNhZmFyaS81MzcuMzYnLAogICAgfQogICAgcGF5bG9hZCA9IHsKICAgICAgICAncGhvbmVOdW1iZXInOiBwaG9uZV9udW1iZXIKICAgIH0KICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249cGF5bG9hZCkKICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFcnJvciBkdXJpbmcgQVBJIGNhbGw6IHtlfSIpCiAgICAgICAgcmV0dXJuIE5vbmUKCmRlZiBjYWxsX2dwZmlfYXBpKHBob25lX251bWJlcik6CiAgICB1cmwgPSAnaHR0cHM6Ly9ncGZpLWFwaS5ncmFtZWVucGhvbmUuY29tL2FwaS92MS9md2EvcmVxdWVzdC1mb3Itb3RwJwogICAgaGVhZGVycyA9IHsKICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKicsCiAgICAgICAgJ0FjY2VwdC1MYW5ndWFnZSc6ICdlbi1VUyxlbjtxPTAuOScsCiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiAnQmFzaWMgYm1WdGIySnNkV1U2UVhCcFZYTmxja0JIVUVacCcsCiAgICAgICAgJ0Nvbm5lY3Rpb24nOiAna2VlcC1hbGl2ZScsCiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAnT3JpZ2luJzogJ2h0dHBzOi8vZ3BmaS5ncmFtZWVucGhvbmUuY29tJywKICAgICAgICAnUmVmZXJlcic6ICdodHRwczovL2dwZmkuZ3JhbWVlbnBob25lLmNvbS8nLAogICAgICAgICdTZWMtRmV0Y2gtRGVzdCc6ICdlbXB0eScsCiAgICAgICAgJ1NlYy1GZXRjaC1Nb2RlJzogJ2NvcnMnLAogICAgICAgICdTZWMtRmV0Y2gtU2l0ZSc6ICdzYW1lLXNpdGUnLAogICAgICAgICdVc2VyLUFnZW50JzogJ01vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgSykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzNy4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNicsCiAgICAgICAgJ3NlYy1jaC11YSc6ICciQ2hyb21pdW0iO3Y9IjEzNyIsICJOb3QvQSlCcmFuZCI7dj0iMjQiJywKICAgICAgICAnc2VjLWNoLXVhLW1vYmlsZSc6ICc/MScsCiAgICAgICAgJ3NlYy1jaC11YS1wbGF0Zm9ybSc6ICciQW5kcm9pZCInLAogICAgfQogICAgcGF5bG9hZCA9IHsKICAgICAgICAncGhvbmUnOiBwaG9uZV9udW1iZXIsCiAgICAgICAgJ2VtYWlsJzogJycsCiAgICAgICAgJ2xhbmd1YWdlJzogJ2VuJwogICAgfQogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywganNvbj1wYXlsb2FkKQogICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIGR1cmluZyBHUEZJIEFQSSBjYWxsOiB7ZX0iKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgY2FsbF9naG9vcmlfYXBpKHBob25lX251bWJlcik6CiAgICBwaG9uZSA9ICIrODgiICsgcGhvbmVfbnVtYmVyCiAgICB1cmwgPSAiaHR0cHM6Ly9hcGkuZ2hvb3JpbGVhcm5pbmcuY29tL2FwaS9hdXRoL3NpZ251cC9vdHA/X2FwcF9wbGF0Zm9ybT13ZWImX2xhbmc9Ym4iCiAgICBoZWFkZXJzID0gewogICAgICAgICJBY2NlcHQiOiAiYXBwbGljYXRpb24vanNvbiwgdGV4dC9wbGFpbiwgKi8qIiwKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICJPcmlnaW4iOiAiaHR0cHM6Ly9naG9vcmlsZWFybmluZy5jb20iLAogICAgICAgICJSZWZlcmVyIjogImh0dHBzOi8vZ2hvb3JpbGVhcm5pbmcuY29tLyIsCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBLKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTM3LjAuMC4wIE1vYmlsZSBTYWZhcmkvNTM3LjM2IiwKICAgICAgICAic2VjLWNoLXVhIjogJyJDaHJvbWl1bSI7dj0iMTM3IiwgIk5vdC9BKUJyYW5kIjt2PSIyNCInLAogICAgICAgICJzZWMtY2gtdWEtbW9iaWxlIjogIj8xIiwKICAgICAgICAic2VjLWNoLXVhLXBsYXRmb3JtIjogJyJBbmRyb2lkIicsCiAgICAgICAgInNlYy1mZXRjaC1kZXN0IjogImVtcHR5IiwKICAgICAgICAic2VjLWZldGNoLW1vZGUiOiAiY29ycyIsCiAgICAgICAgInNlYy1mZXRjaC1zaXRlIjogInNhbWUtc2l0ZSIKICAgIH0KICAgIGRhdGEgPSB7Im1vYmlsZV9ubyI6IHBob25lX251bWJlcn0KCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHZlcmlmeT1GYWxzZSkKICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIGNhbGxfZWFzeV9hcGkocGhvbmVfbnVtYmVyKToKICAgIHVybCA9ICJodHRwczovL2NvcmUuZWFzeS5jb20uYmQvYXBpL3YxL3JlZ2lzdHJhdGlvbiIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L3BsYWluLCAqLyoiLAogICAgICAgICJBY2NlcHQtTGFuZ3VhZ2UiOiAiZW4tVVMsZW47cT0wLjkiLAogICAgICAgICJDb25uZWN0aW9uIjogImtlZXAtYWxpdmUiLAogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgIk9yaWdpbiI6ICJodHRwczovL2Vhc3kuY29tLmJkIiwKICAgICAgICAiUmVmZXJlciI6ICJodHRwczovL2Vhc3kuY29tLmJkLyIsCiAgICAgICAgIlNlYy1GZXRjaC1EZXN0IjogImVtcHR5IiwKICAgICAgICAiU2VjLUZldGNoLU1vZGUiOiAiY29ycyIsCiAgICAgICAgIlNlYy1GZXRjaC1TaXRlIjogInNhbWUtc2l0ZSIsCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBLKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTM3LjAuMC4wIE1vYmlsZSBTYWZhcmkvNTM3LjM2IiwKICAgICAgICAiZGV2aWNlLWtleSI6ICJmM2FhNWFjYWYxN2RlNjRkYjdkODJhMDBjNzMxNzhhZiIsCiAgICAgICAgImxhbmciOiAiZW4iLAogICAgICAgICJzZWMtY2gtdWEiOiAnIkNocm9taXVtIjt2PSIxMzciLCAiTm90L0EpQnJhbmQiO3Y9IjI0IicsCiAgICAgICAgInNlYy1jaC11YS1tb2JpbGUiOiAiPzEiLAogICAgICAgICJzZWMtY2gtdWEtcGxhdGZvcm0iOiAnIkFuZHJvaWQiJwogICAgfQogICAgcGF5bG9hZCA9IHsKICAgICAgICAic29jaWFsX2xvZ2luX2lkIjogIiIsCiAgICAgICAgIm5hbWUiOiAiUnJyciIsCiAgICAgICAgImVtYWlsIjogImdvb2dsZUBnbWFpbC5jb20iLAogICAgICAgICJtb2JpbGUiOiBwaG9uZV9udW1iZXIsCiAgICAgICAgInBhc3N3b3JkIjogIjEyMzQ1Njc4IiwKICAgICAgICAicGFzc3dvcmRfY29uZmlybWF0aW9uIjogIjEyMzQ1Njc4IiwKICAgICAgICAiZGV2aWNlX2tleSI6ICJmM2FhNWFjYWYxN2RlNjRkYjdkODJhMDBjNzMxNzhhZiIKICAgIH0KCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBqc29uPXBheWxvYWQpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBjYWxsX3N1bmRhcmJhbl9hcGkocGhvbmVfbnVtYmVyKToKICAgIHVybCA9ICJodHRwczovL2FwaS1nYXRld2F5LnN1bmRhcmJhbmNvdXJpZXJsdGQuY29tL2dyYXBocWwiCiAgICBoZWFkZXJzID0gewogICAgICAgICJhdXRob3JpdHkiOiAiYXBpLWdhdGV3YXkuc3VuZGFyYmFuY291cmllcmx0ZC5jb20iLAogICAgICAgICJhY2NlcHQiOiAiKi8qIiwKICAgICAgICAiYWNjZXB0LWxhbmd1YWdlIjogImVuLVVTLGVuO3E9MC45IiwKICAgICAgICAiYXV0aG9yaXphdGlvbiI6ICIiLCAgIyBMZWZ0IGJsYW5rIGFzIGluIGN1cmwKICAgICAgICAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICJvcmlnaW4iOiAiaHR0cHM6Ly9jdXN0b21lci5zdW5kYXJiYW5jb3VyaWVybHRkLmNvbSIsCiAgICAgICAgInJlZmVyZXIiOiAiaHR0cHM6Ly9jdXN0b21lci5zdW5kYXJiYW5jb3VyaWVybHRkLmNvbS8iLAogICAgICAgICJzZWMtY2gtdWEiOiAnIkNocm9taXVtIjt2PSIxMzciLCAiTm90L0EpQnJhbmQiO3Y9IjI0IicsCiAgICAgICAgInNlYy1jaC11YS1tb2JpbGUiOiAiPzEiLAogICAgICAgICJzZWMtY2gtdWEtcGxhdGZvcm0iOiAnIkFuZHJvaWQiJywKICAgICAgICAic2VjLWZldGNoLWRlc3QiOiAiZW1wdHkiLAogICAgICAgICJzZWMtZmV0Y2gtbW9kZSI6ICJjb3JzIiwKICAgICAgICAic2VjLWZldGNoLXNpdGUiOiAic2FtZS1zaXRlIiwKICAgICAgICAidXNlci1hZ2VudCI6ICJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMzcuMC4wLjAgTW9iaWxlIFNhZmFyaS81MzcuMzYiCiAgICB9CgogICAgcGF5bG9hZCA9IHsKICAgICAgICAib3BlcmF0aW9uTmFtZSI6ICJDcmVhdGVBY2Nlc3NUb2tlbiIsCiAgICAgICAgInZhcmlhYmxlcyI6IHsKICAgICAgICAgICAgImFjY2Vzc1Rva2VuRmlsdGVyIjogewogICAgICAgICAgICAgICAgInVzZXJOYW1lIjogcGhvbmVfbnVtYmVyCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgICJxdWVyeSI6ICIiIm11dGF0aW9uIENyZWF0ZUFjY2Vzc1Rva2VuKCRhY2Nlc3NUb2tlbkZpbHRlcjogQWNjZXNzVG9rZW5JbnB1dCEpIHsKICBjcmVhdGVBY2Nlc3NUb2tlbihhY2Nlc3NUb2tlbkZpbHRlcjogJGFjY2Vzc1Rva2VuRmlsdGVyKSB7CiAgICBtZXNzYWdlCiAgICBzdGF0dXNDb2RlCiAgICByZXN1bHQgewogICAgICBwaG9uZQogICAgICBvdHBDb3VudGVyCiAgICAgIF9fdHlwZW5hbWUKICAgIH0KICAgIF9fdHlwZW5hbWUKICB9Cn0iIiIKICAgIH0KCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBqc29uPXBheWxvYWQpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBjYWxsX3F1aXpnaXJpX2FwaShwaG9uZV9udW1iZXIpOgogICAgdXJsID0gImh0dHBzOi8vZGV2ZWxvcGVyLnF1aXpnaXJpLnh5ei9hcGkvdjIuMC9zZW5kLW90cCIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkFjY2VwdCI6ICIqLyoiLAogICAgICAgICJBY2NlcHQtTGFuZ3VhZ2UiOiAiZW4tVVMsZW47cT0wLjkiLAogICAgICAgICJDb25uZWN0aW9uIjogImtlZXAtYWxpdmUiLAogICAgICAgICJDb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCIsCiAgICAgICAgIk9yaWdpbiI6ICJodHRwczovL2FwcC5xdWl6Z2lyaS5jb20uYmQiLAogICAgICAgICJSZWZlcmVyIjogImh0dHBzOi8vYXBwLnF1aXpnaXJpLmNvbS5iZC8iLAogICAgICAgICJTZWMtRmV0Y2gtRGVzdCI6ICJlbXB0eSIsCiAgICAgICAgIlNlYy1GZXRjaC1Nb2RlIjogImNvcnMiLAogICAgICAgICJTZWMtRmV0Y2gtU2l0ZSI6ICJjcm9zcy1zaXRlIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMzcuMC4wLjAgTW9iaWxlIFNhZmFyaS81MzcuMzYiLAogICAgICAgICJYLVJlcXVlc3RlZC1XaXRoIjogIlhNTEh0dHBSZXF1ZXN0IiwKICAgICAgICAic2VjLWNoLXVhIjogJyJDaHJvbWl1bSI7dj0iMTM3IiwgIk5vdC9BKUJyYW5kIjt2PSIyNCInLAogICAgICAgICJzZWMtY2gtdWEtbW9iaWxlIjogIj8xIiwKICAgICAgICAic2VjLWNoLXVhLXBsYXRmb3JtIjogJyJBbmRyb2lkIicsCiAgICAgICAgIngtYXBpLWtleSI6ICJnWXNpTlNWQkR1Q3Q4eU1VWHBGMDZpUTFlRHJNR3Y2RyIKICAgIH0KCiAgICBwYXlsb2FkID0gewogICAgICAgICJwaG9uZSI6IHBob25lX251bWJlciwKICAgICAgICAiY291bnRyeV9jb2RlIjogIis4OCIsCiAgICAgICAgImZjbV90b2tlbiI6IE5vbmUKICAgIH0KCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBqc29uPXBheWxvYWQpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIGNhbGxfcm9tb25pX2FwaShwaG9uZV9udW1iZXIpOgogICAgdXJsID0gZiJodHRwczovL3JvbW9uaS5jb20uYmQvYXBpL3NlbmQtb3RwP3Bob25lPXtwaG9uZV9udW1iZXJ9IgogICAgaGVhZGVycyA9IHsKICAgICAgICAiYXV0aG9yaXR5IjogInJvbW9uaS5jb20uYmQiLAogICAgICAgICJhY2NlcHQiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgImFjY2VwdC1sYW5ndWFnZSI6ICJlbi1VUyxlbjtxPTAuOSIsCiAgICAgICAgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAicmVmZXJlciI6ICJodHRwczovL3JvbW9uaS5jb20uYmQvc2lnbnVwIiwKICAgICAgICAic2VjLWNoLXVhIjogJyJDaHJvbWl1bSI7dj0iMTM3IiwgIk5vdC9BKUJyYW5kIjt2PSIyNCInLAogICAgICAgICJzZWMtY2gtdWEtbW9iaWxlIjogIj8xIiwKICAgICAgICAic2VjLWNoLXVhLXBsYXRmb3JtIjogJyJBbmRyb2lkIicsCiAgICAgICAgInNlYy1mZXRjaC1kZXN0IjogImVtcHR5IiwKICAgICAgICAic2VjLWZldGNoLW1vZGUiOiAiY29ycyIsCiAgICAgICAgInNlYy1mZXRjaC1zaXRlIjogInNhbWUtb3JpZ2luIiwKICAgICAgICAidXNlci1hZ2VudCI6ICJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMzcuMC4wLjAgTW9iaWxlIFNhZmFyaS81MzcuMzYiLAogICAgICAgICMgQ29va2llIG5vdCByZXF1aXJlZCB1bmxlc3MgeW91IHdhbnQgdG8gc2ltdWxhdGUgYSBsb2dnZWQtaW4gc2Vzc2lvbgogICAgfQoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIGhlYWRlcnM9aGVhZGVycykgIAogICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDAKICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBjYWxsX2JkdGlja2V0c19hcGkocGhvbmVfbnVtYmVyKToKICAgIHVybCA9ICJodHRwczovL2FwaS5iZHRpY2tldHMuY29tOjIwMTAwL3YxL2F1dGgiCiAgICBoZWFkZXJzID0gewogICAgICAgICJhdXRob3JpdHkiOiAiYXBpLmJkdGlja2V0cy5jb206MjAxMDAiLAogICAgICAgICJhY2NlcHQiOiAiYXBwbGljYXRpb24vanNvbiwgdGV4dC9wbGFpbiwgKi8qIiwKICAgICAgICAiYWNjZXB0LWxhbmd1YWdlIjogImVuLVVTLGVuO3E9MC45IiwKICAgICAgICAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICJvcmlnaW4iOiAiaHR0cHM6Ly9iZHRpY2tldHMuY29tIiwKICAgICAgICAicmVmZXJlciI6ICJodHRwczovL2JkdGlja2V0cy5jb20vIiwKICAgICAgICAic2VjLWNoLXVhIjogJyJDaHJvbWl1bSI7dj0iMTM3IiwgIk5vdC9BKUJyYW5kIjt2PSIyNCInLAogICAgICAgICJzZWMtY2gtdWEtbW9iaWxlIjogIj8xIiwKICAgICAgICAic2VjLWNoLXVhLXBsYXRmb3JtIjogJyJBbmRyb2lkIicsCiAgICAgICAgInNlYy1mZXRjaC1kZXN0IjogImVtcHR5IiwKICAgICAgICAic2VjLWZldGNoLW1vZGUiOiAiY29ycyIsCiAgICAgICAgInNlYy1mZXRjaC1zaXRlIjogInNhbWUtc2l0ZSIsCiAgICAgICAgInVzZXItYWdlbnQiOiAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBLKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTM3LjAuMC4wIE1vYmlsZSBTYWZhcmkvNTM3LjM2IgogICAgfQoKICAgIHBheWxvYWQgPSB7CiAgICAgICAgImNyZWF0ZVVzZXJDaGVjayI6IFRydWUsCiAgICAgICAgInBob25lTnVtYmVyIjogZiIrODh7cGhvbmVfbnVtYmVyLmxzdHJpcCgnKycpfSIsCiAgICAgICAgImFwcGxpY2F0aW9uQ2hhbm5lbCI6ICJXRUJfQVBQIgogICAgfQoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249cGF5bG9hZCkgCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIGNhbGxfZ3BmaTFfYXBpKHBob25lX251bWJlcj1Ob25lKToKICAgIGlmIHBob25lX251bWJlciBpcyBOb25lOgogICAgICAgIHBob25lX251bWJlciA9IGlucHV0KCJFbnRlciBwaG9uZSBudW1iZXIgZm9yIEdQRkkgQVBJOiAiKS5zdHJpcCgpCgogICAgdXJsID0gImh0dHBzOi8vd2VibG9naW5kYS5ncmFtZWVucGhvbmUuY29tL2JhY2tlbmQvYXBpL3YxL290cCIKCiAgICBoZWFkZXJzID0gewogICAgICAgICJBY2NlcHQiOiAiYXBwbGljYXRpb24vanNvbiwgdGV4dC9wbGFpbiwgKi8qIiwKICAgICAgICAiQWNjZXB0LUxhbmd1YWdlIjogImVuLVVTLGVuO3E9MC45IiwKICAgICAgICAiQ29ubmVjdGlvbiI6ICJrZWVwLWFsaXZlIiwKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIsCiAgICAgICAgIk9yaWdpbiI6ICJodHRwczovL3d3dy5ncmFtZWVucGhvbmUuY29tIiwKICAgICAgICAiUmVmZXJlciI6ICJodHRwczovL3d3dy5ncmFtZWVucGhvbmUuY29tLyIsCiAgICAgICAgIlNlYy1GZXRjaC1EZXN0IjogImVtcHR5IiwKICAgICAgICAiU2VjLUZldGNoLU1vZGUiOiAiY29ycyIsCiAgICAgICAgIlNlYy1GZXRjaC1TaXRlIjogInNhbWUtc2l0ZSIsCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBLKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTM3LjAuMC4wIE1vYmlsZSBTYWZhcmkvNTM3LjM2IiwKICAgICAgICAic2VjLWNoLXVhIjogJyJDaHJvbWl1bSI7dj0iMTM3IiwgIk5vdC9BKUJyYW5kIjt2PSIyNCInLAogICAgICAgICJzZWMtY2gtdWEtbW9iaWxlIjogIj8xIiwKICAgICAgICAic2VjLWNoLXVhLXBsYXRmb3JtIjogJyJBbmRyb2lkIicsCiAgICB9CgogICAgcGF5bG9hZCA9IHsKICAgICAgICAibXNpc2RuIjogcGhvbmVfbnVtYmVyCiAgICB9CgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1wYXlsb2FkKQogICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDAKICAgIGV4Y2VwdDoKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBjYWxsX2Fyb2dnYV9hcGkocGhvbmVfbnVtYmVyKToKICAgIHVybCA9ICJodHRwczovL2FwaS5hcm9nZ2EuY29tL2F1dGgvdjEvc21zL3NlbmQ/Zj1td2ViJmI9JnY9Jm9zPSZvc3Y9JnJlZlBhcnRuZXI9IgoKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgImFjY2VwdCI6ICIqLyoiLAogICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkO2NoYXJzZXQ9VVRGLTgiLAogICAgICAgICJvcmlnaW4iOiAiaHR0cHM6Ly9tLmFyb2dnYS5jb20iLAogICAgICAgICJyZWZlcmVyIjogImh0dHBzOi8vbS5hcm9nZ2EuY29tLyIsCiAgICAgICAgInVzZXItYWdlbnQiOiAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBLKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTM3LjAuMC4wIE1vYmlsZSBTYWZhcmkvNTM3LjM2IgogICAgfQoKICAgIGRhdGEgPSB7CiAgICAgICAgIm1vYmlsZSI6IGYiKzg4e3Bob25lX251bWJlcn0iLAogICAgICAgICJmY21Ub2tlbiI6ICIiLAogICAgICAgICJyZWZlcnJhbCI6ICIiCiAgICB9CgogICAgdHJ5OgogICAgICAgIHJlcyA9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9ZGF0YSwgdGltZW91dD0xMCkKICAgICAgICByZXR1cm4gcmVzLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBjYWxsX21lZGVhc3lfYXBpKHBob25lX251bWJlcik6CiAgICBwaG9uZSA9ICIrODgiICsgcGhvbmVfbnVtYmVyCiAgICB1cmwgPSBmImh0dHBzOi8vYXBpLm1lZGVhc3kuaGVhbHRoL2FwaS9zZW5kLW90cC97cGhvbmV9LyIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiQWNjZXB0LUxhbmd1YWdlIjogImVuLVVTLGVuO3E9MC45IiwKICAgICAgICAiQ29ubmVjdGlvbiI6ICJrZWVwLWFsaXZlIiwKICAgICAgICAiT3JpZ2luIjogImh0dHBzOi8vbWVkZWFzeS5oZWFsdGgiLAogICAgICAgICJSZWZlcmVyIjogImh0dHBzOi8vbWVkZWFzeS5oZWFsdGgvIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMzcuMC4wLjAgTW9iaWxlIFNhZmFyaS81MzcuMzYiLAogICAgICAgICJTZWMtRmV0Y2gtRGVzdCI6ICJlbXB0eSIsCiAgICAgICAgIlNlYy1GZXRjaC1Nb2RlIjogImNvcnMiLAogICAgICAgICJTZWMtRmV0Y2gtU2l0ZSI6ICJzYW1lLXNpdGUiLAogICAgICAgICJzZWMtY2gtdWEiOiAnIkNocm9taXVtIjt2PSIxMzciLCAiTm90L0EpQnJhbmQiO3Y9IjI0IicsCiAgICAgICAgInNlYy1jaC11YS1tb2JpbGUiOiAiPzEiLAogICAgICAgICJzZWMtY2gtdWEtcGxhdGZvcm0iOiAnIkFuZHJvaWQiJywKICAgIH0KCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBjYWxsX29zdWRwb3Ryb19hcGkocGhvbmVfbnVtYmVyKToKICAgIHBob25lID0gIis4OC0iICsgcGhvbmVfbnVtYmVyCiAgICB1cmwgPSAiaHR0cHM6Ly9hcGkub3N1ZHBvdHJvLmNvbS9hcGkvdjEvdXNlcnMvc2VuZF9vdHAiCiAgICBoZWFkZXJzID0gewogICAgICAgICJBY2NlcHQiOiAiYXBwbGljYXRpb24vanNvbiwgdGV4dC9wbGFpbiwgKi8qIiwKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOCIsCiAgICAgICAgIk9yaWdpbiI6ICJodHRwczovL29zdWRwb3Ryby5jb20iLAogICAgICAgICJSZWZlcmVyIjogImh0dHBzOi8vb3N1ZHBvdHJvLmNvbS8iLAogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgSykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzNy4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNiIsCiAgICAgICAgInNlYy1jaC11YSI6ICciQ2hyb21pdW0iO3Y9IjEzNyIsICJOb3QvQSlCcmFuZCI7dj0iMjQiJywKICAgICAgICAic2VjLWNoLXVhLW1vYmlsZSI6ICI/MSIsCiAgICAgICAgInNlYy1jaC11YS1wbGF0Zm9ybSI6ICciQW5kcm9pZCInLAogICAgICAgICJzZWMtZmV0Y2gtZGVzdCI6ICJlbXB0eSIsCiAgICAgICAgInNlYy1mZXRjaC1tb2RlIjogImNvcnMiLAogICAgICAgICJzZWMtZmV0Y2gtc2l0ZSI6ICJzYW1lLXNpdGUiCiAgICB9CiAgICBkYXRhID0gewogICAgICAgICJtb2JpbGUiOiBwaG9uZSwKICAgICAgICAiZGV2aWNlVG9rZW4iOiAid2ViIiwKICAgICAgICAibGFuZ3VhZ2UiOiAiZW4iLAogICAgICAgICJvcyI6ICJ3ZWIiCiAgICB9CgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhKQogICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDAKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgY2FsbF9hcm9nZ2FfYXBpKHBob25lX251bWJlcik6CiAgICBwaG9uZSA9ICIlMkI4OCIgKyBwaG9uZV9udW1iZXIKICAgIHVybCA9ICJodHRwczovL2FwaS5hcm9nZ2EuY29tL2F1dGgvdjEvc21zL3NlbmQ/Zj1td2ViJmI9JnY9Jm9zPSZvc3Y9JnJlZlBhcnRuZXI9IgogICAgaGVhZGVycyA9IHsKICAgICAgICAiQWNjZXB0IjogIiovKiIsCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7Y2hhcnNldD1VVEYtOCIsCiAgICAgICAgIk9yaWdpbiI6ICJodHRwczovL20uYXJvZ2dhLmNvbSIsCiAgICAgICAgIlJlZmVyZXIiOiAiaHR0cHM6Ly9tLmFyb2dnYS5jb20vIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMzcuMC4wLjAgTW9iaWxlIFNhZmFyaS81MzcuMzYiLAogICAgICAgICJzZWMtY2gtdWEiOiAnIkNocm9taXVtIjt2PSIxMzciLCAiTm90L0EpQnJhbmQiO3Y9IjI0IicsCiAgICAgICAgInNlYy1jaC11YS1tb2JpbGUiOiAiPzEiLAogICAgICAgICJzZWMtY2gtdWEtcGxhdGZvcm0iOiAnIkFuZHJvaWQiJywKICAgICAgICAic2VjLWZldGNoLWRlc3QiOiAiZW1wdHkiLAogICAgICAgICJzZWMtZmV0Y2gtbW9kZSI6ICJjb3JzIiwKICAgICAgICAic2VjLWZldGNoLXNpdGUiOiAic2FtZS1zaXRlIgogICAgfQogICAgZGF0YSA9IGYibW9iaWxlPXtwaG9uZX0mZmNtVG9rZW49JnJlZmVycmFsPSIKCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBkYXRhPWRhdGEpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBjYWxsX21lZGVhc3lfYXBpKHBob25lX251bWJlcik6CiAgICBwaG9uZSA9ICIrODgiICsgcGhvbmVfbnVtYmVyCiAgICB1cmwgPSBmImh0dHBzOi8vYXBpLm1lZGVhc3kuaGVhbHRoL2FwaS9zZW5kLW90cC97cGhvbmV9LyIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiQWNjZXB0LUxhbmd1YWdlIjogImVuLVVTLGVuO3E9MC45IiwKICAgICAgICAiQ29ubmVjdGlvbiI6ICJrZWVwLWFsaXZlIiwKICAgICAgICAiT3JpZ2luIjogImh0dHBzOi8vbWVkZWFzeS5oZWFsdGgiLAogICAgICAgICJSZWZlcmVyIjogImh0dHBzOi8vbWVkZWFzeS5oZWFsdGgvIiwKICAgICAgICAiU2VjLUZldGNoLURlc3QiOiAiZW1wdHkiLAogICAgICAgICJTZWMtRmV0Y2gtTW9kZSI6ICJjb3JzIiwKICAgICAgICAiU2VjLUZldGNoLVNpdGUiOiAic2FtZS1zaXRlIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMzcuMC4wLjAgTW9iaWxlIFNhZmFyaS81MzcuMzYiLAogICAgICAgICJzZWMtY2gtdWEiOiAnIkNocm9taXVtIjt2PSIxMzciLCAiTm90L0EpQnJhbmQiO3Y9IjI0IicsCiAgICAgICAgInNlYy1jaC11YS1tb2JpbGUiOiAiPzEiLAogICAgICAgICJzZWMtY2gtdWEtcGxhdGZvcm0iOiAnIkFuZHJvaWQiJwogICAgfQoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIGhlYWRlcnM9aGVhZGVycykKICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIGNhbGxfdWxhX2FwaShwaG9uZV9udW1iZXIpOgogICAgdXJsID0gImh0dHBzOi8vZXBvcnRhbC51bGEuY29tLmJkL2FwaS9zZW5kLW90cC10by1waG9uZSIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgImFjY2VwdCI6ICIqLyoiLAogICAgICAgICJhY2NlcHQtbGFuZ3VhZ2UiOiAiZW4tVVMsZW47cT0wLjkiLAogICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgIm9yaWdpbiI6ICJodHRwczovL3d3dy51bGEuY29tLmJkIiwKICAgICAgICAicmVmZXJlciI6ICJodHRwczovL3d3dy51bGEuY29tLmJkLyIsCiAgICAgICAgInNlYy1jaC11YSI6ICciQ2hyb21pdW0iO3Y9IjEzNyIsICJOb3QvQSlCcmFuZCI7dj0iMjQiJywKICAgICAgICAic2VjLWNoLXVhLW1vYmlsZSI6ICI/MSIsCiAgICAgICAgInNlYy1jaC11YS1wbGF0Zm9ybSI6ICciQW5kcm9pZCInLAogICAgICAgICJzZWMtZmV0Y2gtZGVzdCI6ICJlbXB0eSIsCiAgICAgICAgInNlYy1mZXRjaC1tb2RlIjogImNvcnMiLAogICAgICAgICJzZWMtZmV0Y2gtc2l0ZSI6ICJzYW1lLXNpdGUiLAogICAgICAgICJ1c2VyLWFnZW50IjogIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgSykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzNy4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNiIKICAgIH0KICAgIGRhdGEgPSB7CiAgICAgICAgInBob25lX251bWJlciI6ICIrODgiICsgcGhvbmVfbnVtYmVyLAogICAgICAgICJmcm9tIjogImN1c3RvbWVyIgogICAgfQoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSkKICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIGNhbGxfbGF6enBoYXJtYV9hcGkocGhvbmVfbnVtYmVyKToKICAgIHVybCA9ICJodHRwczovL3d3dy5sYXp6cGhhcm1hLmNvbS9NZXNzYWdpbmdBcmVhL090cE1lc3NhZ2UvV2ViUmVnaXN0ZXIiCiAgICBoZWFkZXJzID0gewogICAgICAgICJhY2NlcHQiOiAiKi8qIiwKICAgICAgICAiYWNjZXB0LWxhbmd1YWdlIjogImVuLVVTLGVuO3E9MC45IiwKICAgICAgICAiYWNjZXNzLWNvbnRyb2wtYWxsb3ctb3JpZ2luIjogIioiLAogICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgIm9yaWdpbiI6ICJodHRwczovL3d3dy5sYXp6cGhhcm1hLmNvbSIsCiAgICAgICAgInJlZmVyZXIiOiAiaHR0cHM6Ly93d3cubGF6enBoYXJtYS5jb20vIiwKICAgICAgICAic2VjLWNoLXVhIjogJyJDaHJvbWl1bSI7dj0iMTM3IiwgIk5vdC9BKUJyYW5kIjt2PSIyNCInLAogICAgICAgICJzZWMtY2gtdWEtbW9iaWxlIjogIj8xIiwKICAgICAgICAic2VjLWNoLXVhLXBsYXRmb3JtIjogJyJBbmRyb2lkIicsCiAgICAgICAgInNlYy1mZXRjaC1kZXN0IjogImVtcHR5IiwKICAgICAgICAic2VjLWZldGNoLW1vZGUiOiAiY29ycyIsCiAgICAgICAgInNlYy1mZXRjaC1zaXRlIjogInNhbWUtb3JpZ2luIiwKICAgICAgICAidXNlci1hZ2VudCI6ICJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMzcuMC4wLjAgTW9iaWxlIFNhZmFyaS81MzcuMzYiCiAgICB9CiAgICBkYXRhID0gewogICAgICAgICJBY3Rpdml0eUlkIjogIjE4MzRiODk3LTQ4ODQtNDYzMC1hOTA5LWIxZjA1NGFjMTBlZCIsCiAgICAgICAgIlBob25lIjogIis4OCIgKyBwaG9uZV9udW1iZXIKICAgIH0KCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBjYWxsX3Jva29tYXJpX2FwaShwaG9uZV9udW1iZXIpOgogICAgdXJsID0gZiJodHRwczovL3d3dy5yb2tvbWFyaS5jb20vb3RwL3NlbmQ/ZW1haWxPclBob25lPTg4e3Bob25lX251bWJlcn0mY291bnRyeUNvZGU9QkQiCiAgICBoZWFkZXJzID0gewogICAgICAgICJhY2NlcHQiOiAiKi8qIiwKICAgICAgICAiYWNjZXB0LWxhbmd1YWdlIjogImVuLVVTLGVuO3E9MC45IiwKICAgICAgICAiY29udGVudC1sZW5ndGgiOiAiMCIsCiAgICAgICAgIm9yaWdpbiI6ICJodHRwczovL3d3dy5yb2tvbWFyaS5jb20iLAogICAgICAgICJyZWZlcmVyIjogImh0dHBzOi8vd3d3LnJva29tYXJpLmNvbS9sb2dpbiIsCiAgICAgICAgInNlYy1jaC11YSI6ICciQ2hyb21pdW0iO3Y9IjEzNyIsICJOb3QvQSlCcmFuZCI7dj0iMjQiJywKICAgICAgICAic2VjLWNoLXVhLW1vYmlsZSI6ICI/MSIsCiAgICAgICAgInNlYy1jaC11YS1wbGF0Zm9ybSI6ICciQW5kcm9pZCInLAogICAgICAgICJzZWMtZmV0Y2gtZGVzdCI6ICJlbXB0eSIsCiAgICAgICAgInNlYy1mZXRjaC1tb2RlIjogImNvcnMiLAogICAgICAgICJzZWMtZmV0Y2gtc2l0ZSI6ICJzYW1lLW9yaWdpbiIsCiAgICAgICAgInVzZXItYWdlbnQiOiAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBLKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTM3LjAuMC4wIE1vYmlsZSBTYWZhcmkvNTM3LjM2IiwKICAgICAgICAieC1yZXF1ZXN0ZWQtd2l0aCI6ICJYTUxIdHRwUmVxdWVzdCIKICAgIH0KCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDAKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgY2FsbF9zbWFydHBvc3RiZF9hcGkocGhvbmVfbnVtYmVyKToKICAgIHVybCA9ICdodHRwczovL2FwaS5zbWFydHBvc3RiZC5jb20vb25saW5lLWJvb2tpbmcvYXBpL3JlZ2lzdGVyLW90cCcKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L3BsYWluLCAqLyonLAogICAgICAgICdBY2NlcHQtTGFuZ3VhZ2UnOiAnZW4tVVMsZW47cT0wLjknLAogICAgICAgICdDb25uZWN0aW9uJzogJ2tlZXAtYWxpdmUnLAogICAgICAgICdDb250ZW50LVR5cGUnOiAnbXVsdGlwYXJ0L2Zvcm0tZGF0YTsgYm91bmRhcnk9LS0tLVdlYktpdEZvcm1Cb3VuZGFyeXNHZ3E1MmJwdEhnS3Q1U2UnLAogICAgICAgICdPcmlnaW4nOiAnaHR0cHM6Ly9vbmxpbmUuYnBvZG1zLmdvdi5iZCcsCiAgICAgICAgJ1JlZmVyZXInOiAnaHR0cHM6Ly9vbmxpbmUuYnBvZG1zLmdvdi5iZC8nLAogICAgICAgICdTZWMtRmV0Y2gtRGVzdCc6ICdlbXB0eScsCiAgICAgICAgJ1NlYy1GZXRjaC1Nb2RlJzogJ2NvcnMnLAogICAgICAgICdTZWMtRmV0Y2gtU2l0ZSc6ICdjcm9zcy1zaXRlJywKICAgICAgICAnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMzcuMC4wLjAgTW9iaWxlIFNhZmFyaS81MzcuMzYnLAogICAgICAgICdzZWMtY2gtdWEnOiAnIkNocm9taXVtIjt2PSIxMzciLCAiTm90L0EpQnJhbmQiO3Y9IjI0IicsCiAgICAgICAgJ3NlYy1jaC11YS1tb2JpbGUnOiAnPzEnLAogICAgICAgICdzZWMtY2gtdWEtcGxhdGZvcm0nOiAnIkFuZHJvaWQiJywKICAgIH0KICAgIGRhdGEgPSAoCiAgICAgICAgJy0tLS0tLVdlYktpdEZvcm1Cb3VuZGFyeXNHZ3E1MmJwdEhnS3Q1U2VcclxuJwogICAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9InBob25lIlxyXG5cclxuJwogICAgICAgIGYne3Bob25lX251bWJlcn1cclxuJwogICAgICAgICctLS0tLS1XZWJLaXRGb3JtQm91bmRhcnlzR2dxNTJicHRIZ0t0NVNlXHJcbicKICAgICAgICAnQ29udGVudC1EaXNwb3NpdGlvbjogZm9ybS1kYXRhOyBuYW1lPSJwYXNzd29yZCJcclxuXHJcbicKICAgICAgICAnQTEyMzQ1Njc4YVxyXG4nCiAgICAgICAgJy0tLS0tLVdlYktpdEZvcm1Cb3VuZGFyeXNHZ3E1MmJwdEhnS3Q1U2VcclxuJwogICAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9InJlcGFzc3dvcmQiXHJcblxyXG4nCiAgICAgICAgJ0ExMjM0NTY3OGFcclxuJwogICAgICAgICctLS0tLS1XZWJLaXRGb3JtQm91bmRhcnlzR2dxNTJicHRIZ0t0NVNlLS1cclxuJwogICAgKQogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhLCB2ZXJpZnk9RmFsc2UpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBjYWxsX2RpZ2loYWF0X2FwaShwaG9uZV9udW1iZXIpOgogICAgdXJsID0gImh0dHBzOi8vYXBpLmRpZ2loYWF0LmNvbS5iZC9hcGkvb3RwL2dlbmVyYXRlLW90cCIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L3BsYWluLCAqLyoiLAogICAgICAgICJBY2NlcHQtTGFuZ3VhZ2UiOiAiZW4tVVMsZW47cT0wLjksYm4tQkQ7cT0wLjgsYm47cT0wLjciLAogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgIk9yaWdpbiI6ICJodHRwczovL2RpZ2loYWF0LmNvbS5iZCIsCiAgICAgICAgIlJlZmVyZXIiOiAiaHR0cHM6Ly9kaWdpaGFhdC5jb20uYmQvIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMzcuMC4wLjAgTW9iaWxlIFNhZmFyaS81MzcuMzYiLAogICAgfQogICAgZGF0YSA9IHsicGhvbmVObyI6IHBob25lX251bWJlcn0KICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSkKICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAxCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIGNhbGxfd2FsdG9ucGxhemFfYXBpKHBob25lX251bWJlcik6CiAgICB1cmwgPSAiaHR0cHM6Ly93YWx0b25wbGF6YS5jb20uYmQvYXBpL2F1dGgvb3RwL2NyZWF0ZSIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgImFjY2VwdCI6ICIqLyoiLAogICAgICAgICJhY2NlcHQtbGFuZ3VhZ2UiOiAiZW4tVVMsZW47cT0wLjksYm4tQkQ7cT0wLjgsYm47cT0wLjciLAogICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgIm9yaWdpbiI6ICJodHRwczovL3dhbHRvbnBsYXphLmNvbS5iZCIsCiAgICAgICAgInJlZmVyZXIiOiAiaHR0cHM6Ly93YWx0b25wbGF6YS5jb20uYmQvYXV0aC9waG9uZS1sb2dpbiIsCiAgICAgICAgInVzZXItYWdlbnQiOiAiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBLKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTM3LjAuMC4wIE1vYmlsZSBTYWZhcmkvNTM3LjM2IgogICAgfQoKICAgIGRhdGEgPSB7CiAgICAgICAgImF1dGgiOiB7CiAgICAgICAgICAgICJjb3VudHJ5Q29kZSI6ICI4ODAiLAogICAgICAgICAgICAiZGV2aWNlVXVpZCI6ICI3ZjU0NjQ4MC0zMmQ3LTExZjAtOGJhOS0yN2Q5MGNhN2JkNDgiLAogICAgICAgICAgICAicGhvbmUiOiBwaG9uZV9udW1iZXIubHN0cmlwKCIrODgiKSwKICAgICAgICAgICAgInR5cGUiOiAiTE9HSU4iCiAgICAgICAgfSwKICAgICAgICAiY2FwdGNoYVRva2VuIjogIm5vIHJlY2FwY2hhIgogICAgfQoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBqc29uPWRhdGEsIGhlYWRlcnM9aGVhZGVycykKICAgICAgICByZXR1cm4gcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwCiAgICBleGNlcHQ6CiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgY2FsbF9zaHdhcG5vX2FwaShwaG9uZV9udW1iZXIpOgogICAgdXJsID0gImh0dHBzOi8vd3d3LnNod2Fwbm8uY29tL2FwaS9hdXRoIgogICAgaGVhZGVycyA9IHsKICAgICAgICAiYWNjZXB0IjogIiovKiIsCiAgICAgICAgImFjY2VwdC1sYW5ndWFnZSI6ICJlbi1VUyxlbjtxPTAuOSxibi1CRDtxPTAuOCxibjtxPTAuNyIsCiAgICAgICAgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAib3JpZ2luIjogImh0dHBzOi8vd3d3LnNod2Fwbm8uY29tIiwKICAgICAgICAicmVmZXJlciI6ICJodHRwczovL3d3dy5zaHdhcG5vLmNvbS8iLAogICAgICAgICJzZWMtY2gtdWEiOiAnIkNocm9taXVtIjt2PSIxMzciLCAiTm90L0EpQnJhbmQiO3Y9IjI0IicsCiAgICAgICAgInNlYy1jaC11YS1tb2JpbGUiOiAiPzEiLAogICAgICAgICJzZWMtY2gtdWEtcGxhdGZvcm0iOiAnIkFuZHJvaWQiJywKICAgICAgICAic2VjLWZldGNoLWRlc3QiOiAiZW1wdHkiLAogICAgICAgICJzZWMtZmV0Y2gtbW9kZSI6ICJjb3JzIiwKICAgICAgICAic2VjLWZldGNoLXNpdGUiOiAic2FtZS1vcmlnaW4iLAogICAgICAgICJ1c2VyLWFnZW50IjogIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgSykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEzNy4wLjAuMCBNb2JpbGUgU2FmYXJpLzUzNy4zNiIKICAgIH0KCiAgICBkYXRhID0gewogICAgICAgICJwaG9uZU51bWJlciI6IHBob25lX251bWJlciAgIyBmdWxsIG51bWJlciBtdXN0IGJlIHBhc3NlZCBjb3JyZWN0bHkKICAgIH0KCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwganNvbj1kYXRhLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIGNhbGxfc2hpa2hvX2FwaShwaG9uZV9udW1iZXIpOgogICAgdXJsID0gImh0dHBzOi8vYXBpLnNoaWtoby5jb20vYXV0aC92Mi9zZW5kL3NtcyIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgImFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L3BsYWluLCAqLyoiLAogICAgICAgICJhY2NlcHQtbGFuZ3VhZ2UiOiAiZW4tVVMsZW47cT0wLjksYm4tQkQ7cT0wLjgsYm47cT0wLjciLAogICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgIm9yaWdpbiI6ICJodHRwczovL3Nob3Auc2hpa2hvLmNvbSIsCiAgICAgICAgInJlZmVyZXIiOiAiaHR0cHM6Ly9zaG9wLnNoaWtoby5jb20vIiwKICAgICAgICAidXNlci1hZ2VudCI6ICJNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IEspIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMzcuMC4wLjAgTW9iaWxlIFNhZmFyaS81MzcuMzYiCiAgICB9CgogICAgZGF0YSA9IHsKICAgICAgICAicGhvbmUiOiBwaG9uZV9udW1iZXIsICAjIG11c3QgaW5jbHVkZSA4ODAgcHJlZml4IGlmIG5lZWRlZAogICAgICAgICJ0eXBlIjogInN0dWRlbnQiLAogICAgICAgICJhdXRoX3R5cGUiOiAic2lnbnVwIiwKICAgICAgICAidmVuZG9yIjogInNoaWtobyIKICAgIH0KCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVybCwganNvbj1kYXRhLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMAogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBGYWxzZQojID09PT09PT09PT09PT09PT09PT09PSBBUEkgSEFORExFUiA9PT09PT09PT09PT09PT09PT09PT0KZGVmIGhhbmRsZV9hcGlzKG1vYmlsZV9udW1iZXIpOgogICAgY3VycmVudF9tb2R1bGUgPSBzeXMubW9kdWxlc1tfX25hbWVfX10KICAgIGFwaV9mdW5jdGlvbnMgPSBbCiAgICAgICAgKG5hbWUsIGZ1bmMpIGZvciBuYW1lLCBmdW5jIGluIGluc3BlY3QuZ2V0bWVtYmVycyhjdXJyZW50X21vZHVsZSwgaW5zcGVjdC5pc2Z1bmN0aW9uKQogICAgICAgIGlmIG5hbWUuc3RhcnRzd2l0aCgiY2FsbF8iKSBhbmQgbmFtZS5lbmRzd2l0aCgiX2FwaSIpCiAgICBdCgogICAgc3VjY2Vzc19hcGlzID0gW10KICAgIGZhaWxlZF9hcGlzID0gW10KCiAgICBmb3IgbmFtZSwgYXBpX2Z1bmMgaW4gYXBpX2Z1bmN0aW9uczoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIGFwaV9mdW5jKG1vYmlsZV9udW1iZXIpOgogICAgICAgICAgICAgICAgc3VjY2Vzc19hcGlzLmFwcGVuZChuYW1lKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZmFpbGVkX2FwaXMuYXBwZW5kKG5hbWUpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgZmFpbGVkX2FwaXMuYXBwZW5kKG5hbWUpCgogICAgcmV0dXJuIHN1Y2Nlc3NfYXBpcywgZmFpbGVkX2FwaXMKCiMgPT09PT09PT09PT09PT09PT09PT09IE1BSU4gPT09PT09PT09PT09PT09PT09PT09CmRlZiBtYWluKCk6CiAgICBhbmltYXRlX2Jhbm5lcigpCiAgICBwcmludChGb3JlLkNZQU4gKyBTdHlsZS5CUklHSFQgKyAiXG5XZWxjb21lIHRvIHRoZSBTTVMg8J+SpUJvb21lcvCfkqUgVG9vbCFcbiIpCiAgICBtb2JpbGVfbnVtYmVyID0gaW5wdXQoRm9yZS5SRUQgKyBTdHlsZS5CUklHSFQgKyAiRW50ZXIgdGhlIG1vYmlsZSBudW1iZXIgKEV4LiAwMTczNDU2Nzg5MCk6ICIpLnN0cmlwKCkKCiAgICBwcmludCgpCgogICAgaWYgbm90IChtb2JpbGVfbnVtYmVyLnN0YXJ0c3dpdGgoIjAxIikgYW5kIGxlbihtb2JpbGVfbnVtYmVyKSA9PSAxMSk6CiAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyAiSW52YWxpZCBudW1iZXIuIE11c3Qgc3RhcnQgd2l0aCAwMSBhbmQgYmUgMTEgZGlnaXRzLiIpCiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIG1lc3NhZ2VfZ29hbCA9IGludChpbnB1dChGb3JlLllFTExPVyArIFN0eWxlLkJSSUdIVCArICJIb3cgbWFueSBtZXNzYWdlcyBkbyB5b3Ugd2FudCB0byBzZW5kPyAgOiAiKSkKICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50KEZvcmUuUkVEICsgIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci4iKQogICAgICAgIHJldHVybgoKICAgIGN1cnJlbnRfbW9kdWxlID0gc3lzLm1vZHVsZXNbX19uYW1lX19dCiAgICBhcGlfZnVuY3Rpb25zID0gWwogICAgICAgIGZ1bmMgZm9yIG5hbWUsIGZ1bmMgaW4gaW5zcGVjdC5nZXRtZW1iZXJzKGN1cnJlbnRfbW9kdWxlLCBpbnNwZWN0LmlzZnVuY3Rpb24pCiAgICAgICAgaWYgbmFtZS5zdGFydHN3aXRoKCJjYWxsXyIpIGFuZCBuYW1lLmVuZHN3aXRoKCJfYXBpIikKICAgIF0KCiAgICBtYXhfYXZhaWxhYmxlID0gbGVuKGFwaV9mdW5jdGlvbnMpCiAgICBwcmludChGb3JlLk1BR0VOVEEgKyAiXG5TZW5kaW5nIFNNUy4uLlxuIi5jZW50ZXIoc2h1dGlsLmdldF90ZXJtaW5hbF9zaXplKCkuY29sdW1ucykpCgogICAgdG90YWxfc3VjY2VzcyA9IFtdCiAgICB0b3RhbF9mYWlsZWQgPSBbXQogICAgc2VudF9jb3VudCA9IDAgICMgQ291bnQgc3VjY2Vzc2Z1bCBzZW5kcwoKICAgIGlmIG1lc3NhZ2VfZ29hbCA+PSBtYXhfYXZhaWxhYmxlOgogICAgICAgIGZvciBhcGlfZnVuYyBpbiBhcGlfZnVuY3Rpb25zOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBhcGlfZnVuYyhtb2JpbGVfbnVtYmVyKToKICAgICAgICAgICAgICAgICAgICB0b3RhbF9zdWNjZXNzLmFwcGVuZChhcGlfZnVuYy5fX25hbWVfXykKICAgICAgICAgICAgICAgICAgICBzZW50X2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICB0ZXJtX3dpZHRoID0gc2h1dGlsLmdldF90ZXJtaW5hbF9zaXplKCkuY29sdW1ucwogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyBTdHlsZS5CUklHSFQgKyBmIlxyeydTTVMgc2VudCA9ICcgKyBzdHIoc2VudF9jb3VudCk6Xnt0ZXJtX3dpZHRofX0iLCBlbmQ9JycsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHRvdGFsX2ZhaWxlZC5hcHBlbmQoYXBpX2Z1bmMuX19uYW1lX18pCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuMykgICMgZGVsYXkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIHRvdGFsX2ZhaWxlZC5hcHBlbmQoYXBpX2Z1bmMuX19uYW1lX18pCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuMykKICAgIGVsc2U6CiAgICAgICAgc3VjY2Vzc19jb3VudCA9IDAKICAgICAgICB3aGlsZSBzdWNjZXNzX2NvdW50IDwgbWVzc2FnZV9nb2FsOgogICAgICAgICAgICBmb3IgYXBpX2Z1bmMgaW4gYXBpX2Z1bmN0aW9uczoKICAgICAgICAgICAgICAgIGlmIHN1Y2Nlc3NfY291bnQgPj0gbWVzc2FnZV9nb2FsOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgYXBpX2Z1bmMobW9iaWxlX251bWJlcik6CiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX3N1Y2Nlc3MuYXBwZW5kKGFwaV9mdW5jLl9fbmFtZV9fKQogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgc2VudF9jb3VudCArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIHRlcm1fd2lkdGggPSBzaHV0aWwuZ2V0X3Rlcm1pbmFsX3NpemUoKS5jb2x1bW5zCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyBTdHlsZS5CUklHSFQgKyBmIlxyeydTTVMgc2VudCA9ICcgKyBzdHIoc2VudF9jb3VudCk6Xnt0ZXJtX3dpZHRofX0iLCBlbmQ9JycsIGZsdXNoPVRydWUpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfZmFpbGVkLmFwcGVuZChhcGlfZnVuYy5fX25hbWVfXykKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuMykKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgdG90YWxfZmFpbGVkLmFwcGVuZChhcGlfZnVuYy5fX25hbWVfXykKICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuMykKCiAgICBwcmludCgiXG4iKQogICAgcHJpbnQoRm9yZS5DWUFOICsgIlxuU3VtbWFyeTpcbiIuY2VudGVyKHNodXRpbC5nZXRfdGVybWluYWxfc2l6ZSgpLmNvbHVtbnMpKQogICAgcHJpbnQoRm9yZS5HUkVFTiArIGYi4pyUIFRvdGFsIFN1Y2Nlc3NmdWw6IHtsZW4odG90YWxfc3VjY2Vzcyl9Ii5jZW50ZXIoc2h1dGlsLmdldF90ZXJtaW5hbF9zaXplKCkuY29sdW1ucykpCiAgICBwcmludChGb3JlLlJFRCArIGYiXG7inJggVG90YWwgRmFpbGVkIEF0dGVtcHRzOiB7bGVuKHRvdGFsX2ZhaWxlZCl9Ii5jZW50ZXIoc2h1dGlsLmdldF90ZXJtaW5hbF9zaXplKCkuY29sdW1ucykpCiAgICBpZiB0b3RhbF9mYWlsZWQ6CiAgICAgICAgZm9yIGFwaSBpbiB0b3RhbF9mYWlsZWQ6CiAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgZiIgIOKGkiB7YXBpfSIpCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIG1haW4oKQ=='))